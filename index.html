<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daniels veldig fancy investeringskalkulator</title>
    
    <!-- Laster inn Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Laster inn React og ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- VIKTIG: Laster inn prop-types som kreves av Recharts i nettleseren -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Laster inn Babel for 친 oversette JSX (React-koden) i nettleseren -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Laster inn Recharts for grafer -->
    <script src="https://unpkg.com/recharts@2.12.0/umd/Recharts.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <div id="root"></div>

    <script type="text/babel">
        // Henter funksjoner fra bibliotekene
        const { useState, useMemo } = React;
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Area, ComposedChart, 
            BarChart, Bar, Cell, ErrorBar
        } = Recharts;

        // Ikoner (SVG)
        const Icons = {
            Calculator: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            DollarSign: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            ZapOff: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="12.41 6.75 13 2 10.57 4.92"/><polyline points="18.57 12.91 21 10 15.66 10"/><polyline points="8 8 3 14 12 14 11 22 16 16"/><line x1="1" x2="23" y1="1" y2="23"/></svg>,
            PieChart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>,
            Droplets: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>,
            FileText: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>
        };

        const InvestmentCalculator = () => {
            // --- STATE ---
            const [startCapital, setStartCapital] = useState(1500000);
            const [years, setYears] = useState(10);
            const [simulateCrash, setSimulateCrash] = useState(false);
            const [withdrawalYear, setWithdrawalYear] = useState(5);
            
            // Configuration - Updated defaults based on DNB/Nordea examples
            const [config, setConfig] = useState({
                loan: { rate: 4.793, cost: 0, tax: 22, vol: 0, liq: 1, name: 'Betale Boligl친n', color: '#16a34a' },
                savings: { rate: 4.60, cost: 0, tax: 22, vol: 0, liq: 3, name: 'Sparekonto', color: '#6b7280' },
                // DNB Likviditet A: ~5.3-5.45% return, 0.35 cost
                liquidity: { rate: 5.45, cost: 0.35, tax: 22, vol: 1.5, liq: 3, name: 'Likviditetsfond', color: '#2563eb' },
                // Average of Landkreditt/Arctic: ~6.5% return, ~0.38% cost
                bonds: { rate: 6.50, cost: 0.38, tax: 22, vol: 6.0, liq: 2, name: 'Obligasjon (High Yield)', color: '#d97706' },
                // DNB Global Indeks A: 0.20 cost
                index: { rate: 8.00, cost: 0.20, tax: 37.84, vol: 15, liq: 3, shield: 3.2, name: 'Indeksfond', color: '#dc2626' }
            });

            // --- HELPER: Rate Curve (Central Bank Simulation) ---
            const getProjectedRate = (baseRate, year) => {
                const maxCut = 1.0; 
                const cutPerYear = 1.0 / 3; 
                const currentCut = Math.min(maxCut, year * cutPerYear);
                return Math.max(0, baseRate - currentCut);
            };

            // --- FORMATTERS ---
            const formatNOK = (value) => 
                new Intl.NumberFormat('no-NO', { style: 'currency', currency: 'NOK', maximumFractionDigits: 0 }).format(value);

            const formatCompact = (value) => 
                new Intl.NumberFormat('no-NO', { notation: 'compact', compactDisplay: 'short', maximumFractionDigits: 1 }).format(value);

            // --- CALCULATION LOGIC ---
            const data = useMemo(() => {
                let resultData = [];
                let currentValues = {
                    loan: startCapital,
                    savings: startCapital,
                    liquidityGross: startCapital,
                    bondsGross: startCapital,
                    indexGross: startCapital
                };

                for (let t = 0; t <= years; t++) {
                    let row = { name: `칀r ${t}`, year: t };

                    if (t === 0) {
                        ['loan', 'savings', 'liquidity', 'bonds', 'index'].forEach(k => {
                            row[k] = startCapital;
                            row[`${k}High`] = startCapital;
                            row[`${k}Low`] = startCapital;
                            row[`${k}Dev`] = 0;
                        });
                    } else {
                        const isCrashYear = simulateCrash && t === 1;

                        const loanCurrentRate = getProjectedRate(config.loan.rate, t);
                        const savingsCurrentRate = getProjectedRate(config.savings.rate, t);

                        const loanNetRate = (loanCurrentRate / 100) * (1 - config.loan.tax/100);
                        currentValues.loan *= (1 + loanNetRate);
                        
                        const savingsNetRate = (savingsCurrentRate / 100) * (1 - config.savings.tax/100);
                        currentValues.savings *= (1 + savingsNetRate);

                        let liqRate = getProjectedRate(config.liquidity.rate, t);
                        if (simulateCrash && t >= 1) liqRate *= 0.7; 
                        const liqGrossRate = (liqRate - config.liquidity.cost) / 100;
                        currentValues.liquidityGross *= (1 + liqGrossRate);

                        let bondBaseRate = getProjectedRate(config.bonds.rate, t); 
                        let bondReturn = bondBaseRate / 100;
                        
                        if (isCrashYear) bondReturn = -0.15; 
                        else if (simulateCrash && t > 1) bondReturn = (bondBaseRate / 100) + 0.02; 
                        
                        currentValues.bondsGross *= (1 + bondReturn - config.bonds.cost/100);

                        let idxReturn = config.index.rate / 100;
                        if (isCrashYear) idxReturn = -0.40;
                        else if (simulateCrash && t > 1) idxReturn = 0.06; 
                        currentValues.indexGross *= (1 + idxReturn - config.index.cost/100);

                        const calcNet = (gross, taxRate, shieldRate = 0) => {
                            const gain = gross - startCapital;
                            if (gain <= 0) return gross;
                            const shield = startCapital * (shieldRate/100) * t;
                            const taxable = Math.max(0, gain - shield);
                            return gross - (taxable * (taxRate/100));
                        };

                        row['loan'] = currentValues.loan;
                        row['savings'] = currentValues.savings;
                        row['liquidity'] = calcNet(currentValues.liquidityGross, config.liquidity.tax);
                        row['bonds'] = calcNet(currentValues.bondsGross, config.bonds.tax);
                        row['index'] = calcNet(currentValues.indexGross, config.index.tax, config.index.shield);

                        const calcRisk = (netValue, volPct) => {
                            const vol = volPct / 100;
                            const dev = vol * Math.sqrt(t); 
                            const deviationValue = netValue * dev; 
                            return {
                                high: netValue + deviationValue,
                                low: netValue - deviationValue,
                                dev: deviationValue
                            };
                        };

                        ['liquidity', 'bonds', 'index', 'loan', 'savings'].forEach(k => {
                            const conf = config[k];
                            const risk = calcRisk(row[k], conf.vol);
                            row[`${k}High`] = risk.high;
                            row[`${k}Low`] = risk.low;
                            row[`${k}Dev`] = risk.dev;
                        });
                    }
                    resultData.push(row);
                }
                return resultData;
            }, [startCapital, years, config, simulateCrash]);

            const withdrawalData = useMemo(() => {
                const yearIndex = Math.min(Math.max(0, withdrawalYear), years);
                const row = data[yearIndex];
                if (!row) return [];

                const createBarData = (key, label) => {
                    const netValue = row[key];
                    const deviation = row[`${key}Dev`]; 
                    const conf = config[key];
                    
                    return {
                        name: label,
                        value: netValue,
                        error: deviation > 1 ? [deviation, deviation] : undefined, 
                        deviationStr: formatCompact(deviation),
                        liquidity: conf.liq,
                        color: conf.color
                    };
                };

                return [
                    createBarData('savings', 'Sparekonto'),
                    createBarData('loan', 'Betale L친n'),
                    createBarData('liquidity', 'Likviditetsfond'),
                    createBarData('bonds', 'Obligasjon'),
                    createBarData('index', 'Indeksfond'),
                ].sort((a,b) => a.value - b.value);

            }, [data, withdrawalYear, config, years]);

            const handleConfigChange = (category, field, value) => {
                setConfig(prev => ({
                    ...prev,
                    [category]: { ...prev[category], [field]: parseFloat(value) }
                }));
            };

            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    return (
                        <div className="bg-white p-4 border border-gray-200 shadow-lg rounded-lg text-sm z-50">
                            <p className="font-bold mb-2 text-gray-700">{label}</p>
                            {payload.map((entry, index) => {
                                if (entry.name.includes('Risiko') || entry.dataKey.includes('High') || entry.dataKey.includes('Low')) return null;
                                
                                const key = entry.dataKey;
                                const dev = entry.payload[`${key}Dev`];
                                const confKey = Object.keys(config).find(k => config[k].name === entry.name || k === key);
                                const liq = confKey ? config[confKey].liq : 0;

                                return (
                                    <div key={index} className="flex flex-col mb-3 last:mb-0">
                                        <div className="flex items-center gap-2" style={{ color: entry.color }}>
                                            <span className="font-semibold">{entry.name}:</span>
                                            <span className="font-mono text-base">{formatNOK(entry.value)}</span>
                                        </div>
                                        {dev > 0 && (
                                            <div className="text-xs text-gray-500 pl-4">
                                                췀 {formatCompact(dev)} (Std.avvik)
                                            </div>
                                        )}
                                        <div className="flex gap-1 pl-4 mt-0.5">
                                            {[1,2,3].map(l => (
                                                <div key={l} className={`w-2 h-2 rounded-full ${l <= liq ? 'bg-blue-400' : 'bg-gray-200'}`} />
                                            ))}
                                            <span className="text-[10px] text-gray-400 ml-1">Likviditet</span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    );
                }
                return null;
            };

            const CustomBarTooltip = ({ active, payload }) => {
                if (active && payload && payload.length) {
                    const data = payload[0].payload;
                    const hasError = data.error && data.error[0] > 1;
                    
                    return (
                        <div className="bg-white p-3 border border-gray-200 shadow-lg rounded-lg text-sm">
                            <p className="font-bold text-gray-700 mb-1">{data.name}</p>
                            <p className="text-lg font-mono text-blue-600 font-bold">{formatNOK(data.value)}</p>
                            {hasError && (
                                <p className="text-gray-500 text-xs">
                                    Risiko: 췀 {formatNOK(data.error[0])}
                                </p>
                            )}
                            <div className="mt-2 pt-2 border-t border-gray-100 flex items-center justify-between gap-4">
                                <span className="text-xs text-gray-500">Likviditetsgrad:</span>
                                <div className="flex gap-1">
                                    {[1,2,3].map(l => (
                                        <Icons.Droplets key={l} className={`w-3 h-3 ${l <= data.liquidity ? 'text-blue-500 fill-blue-500' : 'text-gray-200'}`} />
                                    ))}
                                </div>
                            </div>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="flex flex-col gap-6 p-4 max-w-6xl mx-auto bg-gray-50 min-h-screen font-sans">
                    
                    {/* HEADER */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                            <span className="text-blue-600"><Icons.Calculator /></span>
                            Investeringskalkulator
                        </h1>
                        <p className="text-gray-600 mt-2 text-sm">
                            Inkluderer n친: <strong>Renteprognose</strong> (gradvis nedgang -1.0% over 3 친r), <strong>Uttaksrisiko</strong> og <strong>Likviditetsgrad</strong>.
                        </p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        {/* LEFT COLUMN: CONTROLS */}
                        <div className="space-y-6">
                            
                            {/* SCENARIO TOGGLE */}
                            <div className={`p-5 rounded-xl shadow-sm border transition-all duration-300 ${simulateCrash ? 'bg-red-50 border-red-200' : 'bg-white border-gray-100'}`}>
                                <h3 className="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                    {simulateCrash ? <span className="text-red-600"><Icons.ZapOff /></span> : <span className="text-green-600"><Icons.TrendingUp /></span>}
                                    Scenario
                                </h3>
                                <label className="flex items-center gap-3 cursor-pointer mb-2">
                                    <div className="relative">
                                        <input type="checkbox" checked={simulateCrash} onChange={() => setSimulateCrash(!simulateCrash)} className="sr-only" />
                                        <div className={`block w-14 h-8 rounded-full transition-colors ${simulateCrash ? 'bg-red-500' : 'bg-gray-300'}`}></div>
                                        <div className={`dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform ${simulateCrash ? 'transform translate-x-6' : ''}`}></div>
                                    </div>
                                    <span className="font-medium text-gray-700">{simulateCrash ? "Boble-sprekk" : "Normal"}</span>
                                </label>
                                <p className="text-xs text-gray-500 leading-relaxed">
                                    Begge scenarioer inkluderer n친 standardavvik (usikkerhet).
                                    <br/>
                                    <em>Merk: Renten simulerer en nedgang p친 1.0% de neste 3 친rene.</em>
                                </p>
                            </div>

                            {/* Global Inputs */}
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                                <h3 className="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                                    <Icons.DollarSign className="w-4 h-4" /> Startkapital & Tid
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 uppercase">Bel칮p (NOK)</label>
                                        <input 
                                            type="number" 
                                            value={startCapital}
                                            onChange={(e) => setStartCapital(Number(e.target.value))}
                                            className="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 uppercase flex justify-between">
                                            <span>Horisont (Graf)</span>
                                            <span>{years} 칀r</span>
                                        </label>
                                        <input 
                                            type="range" 
                                            min="2" max="20" 
                                            value={years}
                                            onChange={(e) => setYears(Number(e.target.value))}
                                            className="w-full mt-2 accent-blue-600"
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            {/* Detailed Config Inputs */}
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 max-h-[500px] overflow-y-auto">
                                <h3 className="font-semibold text-gray-700 mb-4">Finjuster Satser (%)</h3>
                                
                                {['index', 'bonds', 'liquidity', 'savings'].map((key) => (
                                    <div key={key} className="mb-4 pb-4 border-b border-gray-100 last:border-0 last:pb-0">
                                        <div className="flex items-center gap-2 mb-2 justify-between">
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 rounded-full" style={{backgroundColor: config[key].color}}></div>
                                                <span className="text-sm font-bold text-gray-700">{config[key].name}</span>
                                            </div>
                                            <div className="flex gap-0.5" title="Likviditetsgrad">
                                                {[1,2,3].map(l => (
                                                    <div key={l} className={`w-1.5 h-1.5 rounded-full ${l <= config[key].liq ? 'bg-blue-400' : 'bg-gray-200'}`} />
                                                ))}
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div>
                                                <label className="text-[10px] text-gray-500">Startrente/Avk.</label>
                                                <input 
                                                    type="number" step="0.1"
                                                    value={config[key].rate} 
                                                    onChange={(e) => handleConfigChange(key, 'rate', e.target.value)} 
                                                    className="w-full text-xs p-1 border rounded" 
                                                />
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-gray-500">Risiko (std.avvik)</label>
                                                <input 
                                                    type="number" step="1"
                                                    value={config[key].vol} 
                                                    onChange={(e) => handleConfigChange(key, 'vol', e.target.value)} 
                                                    className="w-full text-xs p-1 border rounded" 
                                                />
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                        </div>

                        {/* RIGHT COLUMN: CHARTS */}
                        <div className="lg:col-span-2 space-y-6">
                            
                            {/* Chart 1: Timeline with Risk Cones */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative">
                                <h3 className="text-lg font-bold text-gray-800 mb-6 flex justify-between items-center">
                                    <span>Verdiutvikling (Netto)</span>
                                    <span className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">Hold over grafen for detaljer</span>
                                </h3>
                                
                                <div className="h-[400px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ComposedChart data={data} margin={{ top: 10, right: 30, left: 20, bottom: 0 }}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e7eb" />
                                            <XAxis dataKey="name" stroke="#9ca3af" fontSize={12} tickLine={false} axisLine={false} />
                                            <YAxis 
                                                stroke="#9ca3af" 
                                                fontSize={12} 
                                                tickFormatter={(val) => `${(val/1000000).toFixed(1)}M`} 
                                                tickLine={false} 
                                                axisLine={false} 
                                                domain={['auto', 'auto']}
                                            />
                                            <Tooltip content={<CustomTooltip />} />
                                            <Legend 
                                                verticalAlign="top" 
                                                height={36} 
                                                iconType="circle"
                                                payload={[
                                                { value: config.loan.name, type: 'line', id: 'loan', color: config.loan.color },
                                                { value: config.savings.name, type: 'line', id: 'savings', color: config.savings.color },
                                                { value: config.liquidity.name, type: 'line', id: 'liquidity', color: config.liquidity.color },
                                                { value: config.bonds.name, type: 'line', id: 'bonds', color: config.bonds.color },
                                                { value: config.index.name, type: 'line', id: 'index', color: config.index.color },
                                                ]}
                                            />
                                            
                                            <Area type="monotone" dataKey="indexHigh" stroke="none" fill={config.index.color} fillOpacity={0.1} name="Risiko Indeks" legendType="none" />
                                            <Area type="monotone" dataKey="indexLow" stroke="none" fill="#fff" fillOpacity={0.8} legendType="none" /> 
                                            
                                            <Area type="monotone" dataKey="bondsHigh" stroke="none" fill={config.bonds.color} fillOpacity={0.15} name="Risiko Obligasjon" legendType="none" />
                                            <Area type="monotone" dataKey="bondsLow" stroke="none" fill="#fff" fillOpacity={0.8} legendType="none" />

                                            <Area type="monotone" dataKey="liquidityHigh" stroke="none" fill={config.liquidity.color} fillOpacity={0.2} name="Risiko Likviditet" legendType="none" />
                                            <Area type="monotone" dataKey="liquidityLow" stroke="none" fill="#fff" fillOpacity={0.8} legendType="none" />
                                            
                                            <Line type="monotone" dataKey="loan" stroke={config.loan.color} strokeWidth={2} dot={false} name="Betale L친n" strokeDasharray="5 5" />
                                            <Line type="monotone" dataKey="savings" stroke={config.savings.color} strokeWidth={2} dot={false} name="Sparekonto" />
                                            <Line type="monotone" dataKey="liquidity" stroke={config.liquidity.color} strokeWidth={2} dot={false} name="Likviditet" />
                                            <Line type="monotone" dataKey="bonds" stroke={config.bonds.color} strokeWidth={2} dot={false} name="Obligasjon" />
                                            <Line type="monotone" dataKey="index" stroke={config.index.color} strokeWidth={3} dot={{r: 3}} name="Indeksfond" />
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            {/* Chart 2: Withdrawal Visualization with Error Bars */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-blue-100">
                                <div className="flex justify-between items-end mb-6 border-b border-gray-100 pb-4">
                                    <div>
                                        <h3 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                            <Icons.PieChart className="w-5 h-5 text-blue-600"/>
                                            Uttak & Risiko
                                        </h3>
                                        <p className="text-sm text-gray-500 max-w-md">
                                            S칮ylene viser forventet nettoverdi. De tynne strekene (T) viser <strong>standardavviket</strong> (usikkerheten) det 친ret.
                                        </p>
                                    </div>
                                    <div className="text-right">
                                        <span className="text-xs font-bold text-blue-600 uppercase">Simul칠r uttak 친r</span>
                                        <div className="flex items-center gap-2">
                                            <span className="text-2xl font-bold text-gray-800">{withdrawalYear}</span>
                                            <input 
                                                type="range" 
                                                min="1" max={years} 
                                                value={withdrawalYear} 
                                                onChange={(e) => setWithdrawalYear(Number(e.target.value))}
                                                className="w-24 accent-blue-600"
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="h-[300px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={withdrawalData} margin={{ top: 20, right: 30, left: 40, bottom: 5 }}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e7eb" />
                                            <XAxis dataKey="name" tickLine={false} axisLine={false} fontSize={12} interval={0} />
                                            <YAxis 
                                                stroke="#374151" 
                                                fontSize={12} 
                                                tickFormatter={(val) => formatCompact(val)} 
                                                tickLine={false} 
                                                axisLine={false} 
                                            />
                                            <Tooltip cursor={{fill: '#f9fafb'}} content={<CustomBarTooltip />} />
                                            <Bar dataKey="value" name="Netto Verdi" barSize={50} radius={[4, 4, 0, 0]}>
                                                {withdrawalData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={entry.color} />
                                                ))}
                                                <ErrorBar dataKey="error" width={4} strokeWidth={2} stroke="#374151" />
                                            </Bar>
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>

                                <div className="mt-4 flex justify-center gap-6 text-xs text-gray-500">
                                    <div className="flex items-center gap-2">
                                        <div className="flex gap-0.5">
                                            <Icons.Droplets className="w-3 h-3 text-blue-500 fill-blue-500" />
                                            <Icons.Droplets className="w-3 h-3 text-gray-200" />
                                            <Icons.Droplets className="w-3 h-3 text-gray-200" />
                                        </div>
                                        <span>Lav Likviditet (L친st)</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="flex gap-0.5">
                                            <Icons.Droplets className="w-3 h-3 text-blue-500 fill-blue-500" />
                                            <Icons.Droplets className="w-3 h-3 text-blue-500 fill-blue-500" />
                                            <Icons.Droplets className="w-3 h-3 text-blue-500 fill-blue-500" />
                                        </div>
                                        <span>H칮y Likviditet (Tilgjengelig)</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    
                    {/* FOOTER: DETAILS & DISCLAIMERS */}
                    <div className="mt-6 bg-white p-6 rounded-xl shadow-sm border border-gray-100 text-sm text-gray-600">
                      <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Icons.FileText className="w-5 h-5 text-gray-500"/>
                        Forutsetninger og Kildegrunnlag
                      </h3>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                          <h4 className="font-semibold text-gray-800 mb-2">Konkrete Fond & Kontoer</h4>
                          <ul className="space-y-2 list-disc list-inside">
                            <li><strong>Sparekonto:</strong> Nordea via fagforeningsavtale (Akademikerne+/UNIO/Lektorlaget). Flyttet fra Danske Bank. Merk: bedre rente enn man f친r ellers p친 markedet</li>
                            <li><strong>Indeksfond:</strong> DNB Global Indeks A. <br/><span className="text-xs ml-4">칀rlig kost: 0,20%. Hist. avkastning (1/3/5 친r): 3,5% / 18% / 15%.</span></li>
                            <li><strong>Likviditetsfond:</strong> DNB Likviditet A. <br/><span className="text-xs ml-4">칀rlig kost: 0,35%. Hist. avkastning (1/3/5 친r): 5,3% / 5,45% / 3,5%.</span></li>
                            <li><strong>Obligasjonsfond (H칮yrente):</strong> Basert p친 snitt av Landkreditt H칮yrente A og Arctic Return Class B. <br/><span className="text-xs ml-4">Kost: 0,32-0,44%. Hist. avkastning: ca 4,6% - 7,35%.</span></li>
                            <li><strong>L친n:</strong> I Statens Pensjonskasse med flytende rente. Markedets beste avtale, kun for statsansatte som meg. 游땕</li>
                              
                          </ul>
                        </div>

                        <div>
                           <h4 className="font-semibold text-gray-800 mb-2">Metodikk i beregningene</h4>
                           <ul className="space-y-2 list-disc list-inside">
                             <li><strong>Skatt:</strong> 22% p친 renteinntekter. 37,84% p친 aksjegevinster (fratrukket skjermingsfradrag).</li>
                             <li><strong>Skjermingsfradrag:</strong> Estimert 친rlig opptjening basert p친 dagens risikofrie rente (ca. 3.2%).</li>
                             <li><strong>Rentebane:</strong> Modellen legger til grunn Norges Banks forventning om at renten skal ned ca. 1.0 prosentpoeng frem mot 2028. Dette p친virker l친nerente, sparekonto og obligasjoner.</li>
                             <li><strong>Risiko (Std.avvik):</strong> Volatilitet er basert p친 historiske svingninger for aktivaklassene. "Boble-scenarioet" er en teoretisk stresstest for 친 vise nedsiderisiko.</li>
                           </ul>
                        </div>
                      </div>
                      <p className="mt-6 text-xs text-gray-400 italic">
                        (Jeg har valgt indeksfond, likviditetsfond og obligasjonsfond som ser helt greie ut, men ikke gjort et dypdykk for 친 optimalisere valget fullstendig.)
                      </p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InvestmentCalculator />);
    </script>
</body>
</html>
